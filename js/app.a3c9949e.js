(function(){"use strict";var t={4149:function(t,e,s){var a=s(6848),n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-layout",attrs:{id:"app"}},[e("router-view")],1)},i=[],c={name:"App"},o=c,r=s(1656),l=(0,r.A)(o,n,i,!1,null,null,null),u=l.exports,d=s(9143),h=s.n(d),p=s(6178),f=function(){var t=this,e=t._self._c;return e("div",[e("el-container",[e("el-container",[e("el-header",[e("NavHead")],1),e("el-main",[e("home")],1)],1)],1)],1)},v=[],b=function(){var t=this;t._self._c;return t._m(0)},_=[function(){var t=this,e=t._self._c;return e("header",{staticClass:"nav-head"},[e("div",{staticClass:"nav-left"},[e("div",{staticClass:"ai-icon"},[t._v("AI")]),e("div",{staticClass:"nav-title-group"},[e("div",{staticClass:"nav-title"},[t._v("Conflict Simulation")]),e("div",{staticClass:"nav-subtitle"},[t._v("智能模拟对话 · 个性化反馈")])])]),e("div",{staticClass:"nav-right"},[e("span",{staticClass:"status-dot"}),e("span",{staticClass:"status-text"},[t._v("在线")]),e("span",{staticClass:"welcome"},[t._v("Ohh")]),e("button",{staticClass:"logout-btn"},[t._v("退出")])])])}],m={name:"NavHead"},C=m,g=(0,r.A)(C,b,_,!1,null,"1756d17a",null),y=g.exports,k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("div",{staticClass:"chat-section"},[t._m(0),e("div",{staticClass:"chat-subtitle"},[t._v("智能模拟对话 · 个性化学习指导")]),e("div",{staticClass:"chat-history"},t._l(t.messages,(function(s,a){return e("div",{key:a,class:["chat-bubble",s.role,{user:"user"===s.role,bot:"bot"===s.role}]},["bot"===s.role?e("span",{staticClass:"bubble-icon"},[t._v("🤖")]):t._e(),"user"===s.role?e("span",{staticClass:"bubble-icon-user"}):t._e(),"bot"===s.role&&!s.text&&t.loading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:[e("span",[t._v(t._s(s.text))])]],2)})),0),e("div",{staticClass:"chat-input-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"chat-input",attrs:{placeholder:"请输入你的回复",disabled:t.loading},domProps:{value:t.input},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.input=e.target.value)}}}),e("button",{staticClass:"chat-send-btn",attrs:{disabled:t.loading},on:{click:t.sendMessage}},[e("svg",{attrs:{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M3 20L21 12L3 4V10L17 12L3 14V20Z",fill:"#a78bfa"}})])])])]),e("div",{staticClass:"feedback-section"},[e("div",{staticClass:"card score-feedback"},[e("div",{staticClass:"card-title score-icon"},[t._v("📖 评分反馈")]),e("div",{staticClass:"score-reason-content"},[t.scoreFeedbackLoading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:t.scoreFeedback?[t._v(" "+t._s(t.scoreFeedback)+" ")]:[t._v(" 基于您的回复质量和态度，给出评分与理由 ")]],2)]),e("div",{staticClass:"card teach-feedback"},[e("div",{staticClass:"card-title teach-icon"},[t._v("🎯 教学反馈")]),e("div",{staticClass:"teach-list"},[t.teachFeedbackLoading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:t.teachFeedback&&t.teachFeedback.length?t._l(t.teachFeedback,(function(s,a){return e("div",{key:a,class:["teach-item",s.colorClass]},[e("span",{staticClass:"teach-item-icon"},[t._v(t._s(s.icon))]),e("span",{staticClass:"teach-item-title"},[t._v(t._s(s.title))]),e("span",{staticClass:"teach-item-content"},[t._v(t._s(s.content))])])})):[t._m(1),t._m(2),t._m(3),t._m(4)]],2)]),t._m(5)])])},w=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-header"},[e("span",{staticClass:"chat-icon"},[t._v("🤖")]),e("span",{staticClass:"chat-title"},[t._v("Conflict Simulation")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-yellow"},[e("span",{staticClass:"teach-item-icon"},[t._v("💡")]),e("span",{staticClass:"teach-item-title"},[t._v("NVC：")]),e("span",{staticClass:"teach-item-content"},[t._v("尝试将复杂问题分解成更小的部分，这样更容易理解和掌握。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-green"},[e("span",{staticClass:"teach-item-icon"},[t._v("⭐")]),e("span",{staticClass:"teach-item-title"},[t._v("Proposal：")]),e("span",{staticClass:"teach-item-content"},[t._v("你已经完成了今天的学习目标！保持这种学习节奏。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-blue"},[e("span",{staticClass:"teach-item-icon"},[t._v("📈")]),e("span",{staticClass:"teach-item-title"},[t._v("Concession：")]),e("span",{staticClass:"teach-item-content"},[t._v("注意到你在分析问题时逻辑清晰，建议继续保持这种思考方式。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-purple"},[e("span",{staticClass:"teach-item-icon"},[t._v("🎯")]),e("span",{staticClass:"teach-item-title"},[t._v("Promise：")]),e("span",{staticClass:"teach-item-content"},[t._v("可以尝试多角度思考问题，这有助于加深对知识的理解。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card study-tips study-tips-yellow"},[e("div",{staticClass:"study-tips-title"},[e("span",{staticClass:"study-tips-icon"},[t._v("💡")]),t._v("学习小贴士")]),e("div",{staticClass:"study-tips-content"},[e("span",{staticClass:"study-tips-icon"},[t._v("📒")]),t._v("每次学习后花几分钟总结要点，有助于知识的长期记忆。")])])}],x=(s(4114),s(8355)),F={data(){return{input:"",messages:[{role:"bot",text:"你好！我是你的Conflict Simulation助手。我可以帮助你模拟和分析各种冲突场景，并提供个性化的指导。"}],loading:!1,scoreFeedback:null,teachFeedback:[],scoreFeedbackLoading:!1,teachFeedbackLoading:!1}},computed:{lastTime(){return"17:25"}},methods:{async sendMessage(){const t=this.input&&this.input.trim();if(!t||this.loading)return;const e="零花钱的使用";this.messages.push({role:"user",text:t}),this.input="",this.loading=!0,this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}));const s={role:"bot",text:""};this.messages.push(s),this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}));let a="";try{const n=await fetch("http://dify.ai-role.cn/v1/chat-messages",{method:"POST",headers:{Authorization:"Bearer app-1FfMKOZZ12LF8HXlpXdTopPG","Content-Type":"application/json"},body:JSON.stringify({query:t,inputs:{training:"引导性对话",title:e},response_mode:"streaming",user:"abc-123"})});if(!n.body||!window.ReadableStream){const i=await n.json();return s.text=i.answer||i.response||"（大模型无回复）",a=s.text,this.loading=!1,this.get_score_feedback(e,t,a),void this.get_teach_feeedback(e,t,a)}const i=n.body.getReader(),c=new TextDecoder("utf-8");let o=!1,r="";while(!o){const{value:t,done:e}=await i.read();if(o=e,t){r+=c.decode(t,{stream:!0});let e=r.split("\n");r=e.pop();for(const t of e){if(!t.trim())continue;if(t.startsWith("event: ping"))continue;let e=t;t.startsWith("data:")&&(e=t.replace(/^data:\s*/,""));try{const t=JSON.parse(e);t.answer?s.text+=t.answer:t.response?s.text+=t.response:"string"===typeof t&&(s.text+=t)}catch{s.text+=e}this.$forceUpdate(),this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}))}}}if(r&&r.trim()){try{const t=JSON.parse(r);t.answer?s.text+=t.answer:t.response?s.text+=t.response:"string"===typeof t&&(s.text+=t)}catch{s.text+=r}this.$forceUpdate()}a=s.text}catch(n){console.error("API请求错误:",n),s.text="机器人服务暂时不可用，请稍后再试。",a=s.text}finally{this.loading=!1,this.get_score_feedback(e,t,a),this.get_teach_feeedback(e,t,a)}},async get_score_feedback(t,e,s){this.scoreFeedbackLoading=!0;try{const a=await x.A.post("http://dify.ai-role.cn/v1/chat-messages",{query:"score feedback",inputs:{title:t,user_response:e,bot_response:s},response_mode:"blocking",user:"abc-123"},{headers:{Authorization:"Bearer app-XPpxMLpT4EmwJ2VwXwvmOBPt","Content-Type":"application/json"}});console.log(a.data.answer),this.scoreFeedback=a.data.answer}catch(a){this.scoreFeedback={reason:"评分反馈获取失败"}}finally{this.scoreFeedbackLoading=!1}},async get_teach_feeedback(t,e,s){this.teachFeedbackLoading=!0;try{const a=await x.A.post("http://dify.ai-role.cn/v1/chat-messages",{query:"teach feedback",inputs:{title:t,user_response:e,bot_response:s},response_mode:"blocking",user:"abc-123"},{headers:{Authorization:"Bearer app-YhRXu8JFuHs9deDyR8AJwYrC","Content-Type":"application/json"}}),n=a.data.answer||"";console.log("教学反馈原始数据:",a.data.answer);const i=[{title:"NVC",icon:"💡",colorClass:"teach-yellow"},{title:"Proposal",icon:"⭐",colorClass:"teach-green"},{title:"Concession",icon:"📈",colorClass:"teach-blue"},{title:"Promise",icon:"🎯",colorClass:"teach-purple"}];let c=[];const o=/(NVC|Proposal|Concession|Promise)：(.*?)(?=(NVC|Proposal|Concession|Promise)：|$)/gs;let r;while(null!==(r=o.exec(n))){const t=i.findIndex((t=>t.title===r[1]));-1!==t&&(c[t]={...i[t],content:r[2].trim()})}if(0===c.length){const t=n.split("\n").filter((t=>t.trim()));t.forEach((t=>{const e=t.indexOf("：");if(e>0){const s=t.substring(0,e).trim(),a=t.substring(e+1).trim(),n=i.findIndex((t=>t.title===s));-1!==n&&(c[n]={...i[n],content:a})}}))}console.log("解析后的教学反馈:",c),this.teachFeedback=i.map(((t,e)=>c[e]||{...t,content:"暂无反馈内容"})),console.log(this.teachFeedback)}catch(a){this.teachFeedback=[]}finally{this.teachFeedbackLoading=!1}}}},O=F,T=(0,r.A)(O,k,w,!1,null,"39607e4e",null),P=T.exports,A={components:{NavHead:y,Home:P},data(){return{}}},S=A,L=(0,r.A)(S,f,v,!1,null,"cf2214fe",null),j=L.exports;a["default"].use(p.Ay);const N=[{path:"/",name:"Main",component:j}],M=new p.Ay({routes:N});var $=M;a["default"].prototype.axios=x.A,a["default"].config.productionTip=!1,a["default"].use(h()),new a["default"]({router:$,render:t=>t(u)}).$mount("#app")}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=t,function(){s.amdO={}}(),function(){var t=[];s.O=function(e,a,n,i){if(!a){var c=1/0;for(u=0;u<t.length;u++){a=t[u][0],n=t[u][1],i=t[u][2];for(var o=!0,r=0;r<a.length;r++)(!1&i||c>=i)&&Object.keys(s.O).every((function(t){return s.O[t](a[r])}))?a.splice(r--,1):(o=!1,i<c&&(c=i));if(o){t.splice(u--,1);var l=n();void 0!==l&&(e=l)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[a,n,i]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var n,i,c=a[0],o=a[1],r=a[2],l=0;if(c.some((function(e){return 0!==t[e]}))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(r)var u=r(s)}for(e&&e(a);l<c.length;l++)i=c[l],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(u)},a=self["webpackChunksimulation"]=self["webpackChunksimulation"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(4149)}));a=s.O(a)})();
//# sourceMappingURL=app.a3c9949e.js.map