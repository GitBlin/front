(function(){"use strict";var t={2443:function(t,e,s){var a=s(6848),i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-layout",attrs:{id:"app"}},[e("router-view")],1)},n=[],o={name:"App"},c=o,r=s(1656),l=(0,r.A)(c,i,n,!1,null,null,null),d=l.exports,u=s(9143),h=s.n(u),p=s(6178),v=function(){var t=this,e=t._self._c;return e("div",[e("el-container",[e("el-container",[e("el-header",[e("NavHead")],1),e("el-main",[e("home")],1)],1)],1)],1)},f=[],_=function(){var t=this;t._self._c;return t._m(0)},g=[function(){var t=this,e=t._self._c;return e("header",{staticClass:"nav-head"},[e("div",{staticClass:"nav-left"},[e("div",{staticClass:"ai-icon"},[t._v("AI")]),e("div",{staticClass:"nav-title-group"},[e("div",{staticClass:"nav-title"},[t._v("Conflict Simulation")]),e("div",{staticClass:"nav-subtitle"},[t._v("智能模拟对话 · 个性化反馈")])])]),e("div",{staticClass:"nav-right"},[e("span",{staticClass:"status-dot"}),e("span",{staticClass:"status-text"},[t._v("在线")]),e("span",{staticClass:"welcome"},[t._v("Ohh")]),e("button",{staticClass:"logout-btn"},[t._v("退出")])])])}],b={name:"NavHead"},m=b,C=(0,r.A)(m,_,g,!1,null,"1756d17a",null),y=C.exports,k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-wrapper"},[e("div",{staticClass:"home-container"},[e("div",{staticClass:"chat-section"},[e("div",{staticClass:"chat-header"},[e("span",{staticClass:"chat-icon"},[t._v("🤖")]),e("span",{staticClass:"chat-title"},[t._v("Conflict Simulation")]),e("button",{staticClass:"chat-settings-btn",attrs:{title:"设置参数"},on:{click:t.openSettings}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 25 25",fill:"none"}},[e("path",{attrs:{d:"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",fill:"#a78bfa"}}),e("path",{attrs:{d:"M19.4 13a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",fill:"#a78bfa"}})])]),e("button",{staticClass:"chat-reset-btn",attrs:{title:"重置对话"},on:{click:t.resetAll}},[e("svg",{attrs:{width:"20",height:"20",viewBox:"0 0 20 20"}},[e("path",{attrs:{d:"M10 2v2a6 6 0 1 1-6 6H2a8 8 0 1 0 8-8z",fill:"#a78bfa"}})])])]),e("div",{staticClass:"chat-subtitle"},[t._v("智能模拟对话 · 个性化学习指导")]),e("div",{staticClass:"chat-history"},t._l(t.messages,(function(s,a){return e("div",{key:a,class:["chat-bubble",s.role,{user:"user"===s.role,bot:"bot"===s.role}]},["bot"===s.role?e("span",{staticClass:"bubble-icon"},[t._v("🤖")]):t._e(),"user"===s.role?e("span",{staticClass:"bubble-icon-user"}):t._e(),"bot"===s.role&&!s.text&&t.loading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:[e("span",[t._v(t._s(s.text))])]],2)})),0),e("div",{staticClass:"chat-input-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"chat-input",attrs:{placeholder:"请输入你的回复",disabled:t.loading},domProps:{value:t.input},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.input=e.target.value)}}}),e("button",{staticClass:"chat-send-btn",attrs:{disabled:t.loading},on:{click:t.sendMessage}},[e("svg",{attrs:{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M3 20L21 12L3 4V10L17 12L3 14V20Z",fill:"#a78bfa"}})])])])]),e("div",{staticClass:"feedback-section"},[e("div",{staticClass:"card score-feedback"},[e("div",{staticClass:"card-title score-icon"},[t._v("📖 评分反馈")]),e("div",{staticClass:"score-reason-content"},[t.scoreFeedbackLoading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:t.scoreFeedback?[t._v(" "+t._s(t.scoreFeedback)+" ")]:[t._v(" 基于您的回复质量和态度，给出评分与理由 ")]],2)]),e("div",{staticClass:"card teach-feedback"},[e("div",{staticClass:"card-title teach-icon"},[t._v("🎯 教学反馈")]),e("div",{staticClass:"teach-list"},[t.teachFeedbackLoading?[e("span",{staticClass:"loading-spinner-in-bubble",attrs:{title:"模型思考中"}})]:t.teachFeedback&&t.teachFeedback.length?t._l(t.teachFeedback,(function(s,a){return e("div",{key:a,class:["teach-item",s.colorClass]},[e("span",{staticClass:"teach-item-icon"},[t._v(t._s(s.icon))]),e("span",{staticClass:"teach-item-title"},[t._v(t._s(s.title))]),e("span",{staticClass:"teach-item-content"},[t._v(t._s(s.content))])])})):[t._m(0),t._m(1),t._m(2),t._m(3)]],2)]),t._m(4)])]),t.showSettingsModal?e("div",{staticClass:"modal-overlay",on:{click:t.closeSettings}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("设置对话模式")]),e("button",{staticClass:"modal-close",on:{click:t.closeSettings}},[t._v("×")])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"training"}},[t._v("对话类型：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.currentTraining,expression:"currentTraining"}],staticClass:"form-select",attrs:{id:"training"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.currentTraining=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:"引导性对话"}},[t._v("引导性对话")]),e("option",{attrs:{value:"非引导性对话"}},[t._v("非引导性对话")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"title"}},[t._v("冲突场景：")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.currentTitle,expression:"currentTitle"}],staticClass:"form-select",attrs:{id:"title"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.currentTitle=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:"零花钱的使用"}},[t._v("零花钱的使用")]),e("option",{attrs:{value:"家务分配不均"}},[t._v("家务分配不均")]),e("option",{attrs:{value:"财务支出争议"}},[t._v("财务支出争议")]),e("option",{attrs:{value:"子女教育争议"}},[t._v("子女教育争议")])])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-cancel",on:{click:t.closeSettings}},[t._v("取消")]),e("button",{staticClass:"btn-save",on:{click:t.saveSettings}},[t._v("保存")])])])]):t._e()])},w=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-yellow"},[e("span",{staticClass:"teach-item-icon"},[t._v("💡")]),e("span",{staticClass:"teach-item-title"},[t._v("NVC")]),e("span",{staticClass:"teach-item-content"},[t._v("非暴力沟通，聚焦需求表达和情感理解而非指责，观察-感受-需要-请求。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-green"},[e("span",{staticClass:"teach-item-icon"},[t._v("⭐")]),e("span",{staticClass:"teach-item-title"},[t._v("Proposal")]),e("span",{staticClass:"teach-item-content"},[t._v("主动提出具体解决方案，寻求双方共同接受的行动方案。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-blue"},[e("span",{staticClass:"teach-item-icon"},[t._v("📈")]),e("span",{staticClass:"teach-item-title"},[t._v("Concession")]),e("span",{staticClass:"teach-item-content"},[t._v("做出让步，主动放弃部分需求，以换取冲突缓解或关系维护。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"teach-item teach-purple"},[e("span",{staticClass:"teach-item-icon"},[t._v("🎯")]),e("span",{staticClass:"teach-item-title"},[t._v("Promise")]),e("span",{staticClass:"teach-item-content"},[t._v("以未来行动作为担保和承诺，换取对方当前合作与信任。")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"card study-tips study-tips-yellow"},[e("div",{staticClass:"study-tips-title"},[e("span",{staticClass:"study-tips-icon"},[t._v("💡")]),t._v("学习小贴士")]),e("div",{staticClass:"study-tips-content"},[e("span",{staticClass:"study-tips-icon"},[t._v("📒")]),t._v("每次对话后花几分钟总结策略的要点，有助于知识的长期巩固。")])])}],x=(s(4114),s(8355)),T={name:"HomePage",data(){return{input:"",messages:[{role:"bot",text:"你好！我是你的Conflict Simulation助手。我可以帮助你模拟和分析各种冲突场景，并提供个性化的指导。"}],loading:!1,scoreFeedback:null,teachFeedback:[],scoreFeedbackLoading:!1,teachFeedbackLoading:!1,showSettingsModal:!1,currentTraining:"引导性对话",currentTitle:"零花钱的使用",conversation_id:"",score_id:"",teach_id:"",quit:0}},computed:{lastTime(){return"17:25"}},methods:{async sendMessage(){const t=this.input&&this.input.trim();if(!t||this.loading)return;const e=this.currentTitle;console.log(this.currentTitle),console.log(this.currentTraining),this.messages.push({role:"user",text:t}),this.input="",this.loading=!0,this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}));const s={role:"bot",text:""};this.messages.push(s),this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}));let a="";try{const i=await fetch("http://dify.ai-role.cn/v1/chat-messages",{method:"POST",headers:{Authorization:"Bearer app-1FfMKOZZ12LF8HXlpXdTopPG","Content-Type":"application/json"},body:JSON.stringify({query:t,inputs:{training:this.currentTraining,title:e,quit:this.quit},response_mode:"streaming",user:"abc-123",conversation_id:this.conversation_id})});if(!i.body||!window.ReadableStream){const n=await i.json();return s.text=n.answer||n.response||"（大模型无回复）",a=s.text,n.conversation_id&&(this.conversation_id=n.conversation_id),this.loading=!1,this.get_score_feedback(e,t,a),void this.get_teach_feedback(e,t,a)}const n=i.body.getReader(),o=new TextDecoder("utf-8");let c=!1,r="";while(!c){const{value:t,done:e}=await n.read();if(c=e,t){r+=o.decode(t,{stream:!0});let e=r.split("\n");r=e.pop();for(const t of e){if(!t.trim())continue;if(t.startsWith("event: ping"))continue;let e=t;t.startsWith("data:")&&(e=t.replace(/^data:\s*/,""));try{const t=JSON.parse(e);t.answer?s.text+=t.answer:t.response?s.text+=t.response:"string"===typeof t&&(s.text+=t),this.conversation_id=t.conversation_id}catch{s.text+=e}this.$forceUpdate(),this.$nextTick((()=>{const t=this.$el.querySelector(".chat-history");t&&(t.scrollTop=t.scrollHeight)}))}}}if(r&&r.trim()){try{const t=JSON.parse(r);t.answer?s.text+=t.answer:t.response?s.text+=t.response:"string"===typeof t&&(s.text+=t)}catch{s.text+=r}this.$forceUpdate()}a=s.text}catch(i){console.error("API请求错误:",i),s.text="机器人服务暂时不可用，请稍后再试。",a=s.text}finally{this.loading=!1,console.log(a),"引导性对话"===this.currentTraining&&"因您连续使用暴力沟通，请您冷静之后再进行回复。Tips：推荐使用NVC策略进行回复。"!=a&&(this.get_score_feedback(e,t,a),this.get_teach_feedback(e,t,a))}},async get_score_feedback(t,e,s){this.scoreFeedbackLoading=!0;try{const a=await x.A.post("http://dify.ai-role.cn/v1/chat-messages",{query:"score feedback",inputs:{title:t,user_response:e,bot_response:s},response_mode:"blocking",user:"abc-123",conversation_id:this.score_id},{headers:{Authorization:"Bearer app-XPpxMLpT4EmwJ2VwXwvmOBPt","Content-Type":"application/json"}});console.log(a.data.answer),this.scoreFeedback=a.data.answer,this.score_id=a.data.conversation_id}catch(a){this.scoreFeedback="评分反馈获取失败"}finally{this.scoreFeedbackLoading=!1}},async get_teach_feedback(t,e,s){this.teachFeedbackLoading=!0;try{const a=await x.A.post("http://dify.ai-role.cn/v1/chat-messages",{query:"teach feedback",inputs:{title:t,user_response:e,bot_response:s},response_mode:"blocking",user:"abc-123",conversation_id:this.teach_id},{headers:{Authorization:"Bearer app-YhRXu8JFuHs9deDyR8AJwYrC","Content-Type":"application/json"}}),i=a.data.answer||"";console.log("教学反馈原始数据:",a.data.answer),this.teach_id=a.data.conversation_id;const n=[{title:"NVC",icon:"💡",colorClass:"teach-yellow"},{title:"Proposal",icon:"⭐",colorClass:"teach-green"},{title:"Concession",icon:"📈",colorClass:"teach-blue"},{title:"Promise",icon:"🎯",colorClass:"teach-purple"}];let o=[];const c=/(NVC|Proposal|Concession|Promise)：(.*?)(?=(NVC|Proposal|Concession|Promise)：|$)/gs;let r;while(null!==(r=c.exec(i))){const t=n.findIndex((t=>t.title===r[1]));-1!==t&&(o[t]={...n[t],content:r[2].trim()})}if(0===o.length){const t=i.split("\n").filter((t=>t.trim()));t.forEach((t=>{const e=t.indexOf("：");if(e>0){const s=t.substring(0,e).trim(),a=t.substring(e+1).trim(),i=n.findIndex((t=>t.title===s));-1!==i&&(o[i]={...n[i],content:a})}}))}console.log("解析后的教学反馈:",o),this.teachFeedback=n.map(((t,e)=>o[e]||{...t,content:"暂无反馈内容"})),console.log(this.teachFeedback)}catch(a){this.teachFeedback=[]}finally{this.teachFeedbackLoading=!1}},openSettings(){this.showSettingsModal=!0},closeSettings(){this.showSettingsModal=!1},saveSettings(){this.showSettingsModal=!1},resetAll(){this.messages=[{role:"bot",text:"你好！我是你的Conflict Simulation助手。我可以帮助你模拟和分析各种冲突场景，并提供个性化的指导。"}],this.input="",this.scoreFeedback=null,this.teachFeedback=[],this.scoreFeedbackLoading=!1,this.teachFeedbackLoading=!1,this.conversation_id="",this.score_id="",this.teach_id=""}}},S=T,F=(0,r.A)(S,k,w,!1,null,"23818ba4",null),O=F.exports,A={name:"MainPage",components:{NavHead:y,Home:O},data(){return{}}},P=A,M=(0,r.A)(P,v,f,!1,null,"8b7bb130",null),L=M.exports;a["default"].use(p.Ay);const H=[{path:"/",name:"Main",component:L}],N=new p.Ay({routes:H});var j=N;a["default"].prototype.axios=x.A,a["default"].config.productionTip=!1,a["default"].use(h()),new a["default"]({router:j,render:t=>t(d)}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var n=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,function(){s.amdO={}}(),function(){var t=[];s.O=function(e,a,i,n){if(!a){var o=1/0;for(d=0;d<t.length;d++){a=t[d][0],i=t[d][1],n=t[d][2];for(var c=!0,r=0;r<a.length;r++)(!1&n||o>=n)&&Object.keys(s.O).every((function(t){return s.O[t](a[r])}))?a.splice(r--,1):(c=!1,n<o&&(o=n));if(c){t.splice(d--,1);var l=i();void 0!==l&&(e=l)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[a,i,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,n,o=a[0],c=a[1],r=a[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(i in c)s.o(c,i)&&(s.m[i]=c[i]);if(r)var d=r(s)}for(e&&e(a);l<o.length;l++)n=o[l],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(d)},a=self["webpackChunksimulation"]=self["webpackChunksimulation"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(2443)}));a=s.O(a)})();
//# sourceMappingURL=app.91583d76.js.map